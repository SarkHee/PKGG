// Prisma schema for clans and clan members
// Save as prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Clan {
  id           Int           @id @default(autoincrement())
  name         String        @unique
  leader       String
  description  String?
  announcement String?
  memberCount  Int
  avgScore     Int?
  mainStyle    String?
  
  // PUBG API 관련 필드들 추가
  pubgClanId   String?       @unique // PUBG API의 clan ID
  pubgClanTag  String?       // PUBG API의 clan tag
  pubgClanLevel Int?         // PUBG API의 clan level
  pubgMemberCount Int?       // PUBG API에서 가져온 멤버 수
  lastSynced   DateTime?     // 마지막 PUBG API 동기화 시간
  
  // 지역/국가 구분 필드들
  region       String?       // 추정 지역 (KR, NA, EU, AS, OC 등)
  isKorean     Boolean?      // 한국 클랜 여부 추정
  shardDistribution String? // 멤버들의 shard 분포 (JSON)
  
  members      ClanMember[]
}

model ClanMember {
  id             Int     @id @default(autoincrement())
  nickname       String
  score          Int
  style          String
  avgDamage      Float
  avgKills       Float   @default(0)
  avgAssists     Float   @default(0)
  avgSurviveTime Float   @default(0)
  winRate        Float   @default(0)
  top10Rate      Float   @default(0)
  clanId         Int
  clan           Clan    @relation(fields: [clanId], references: [id])
  
  // PUBG API 관련 필드들 추가
  pubgClanId     String? // PUBG API의 clan ID (예: "clan.eb5c32a3cc484b59981f9c61e9ea2747")
  pubgPlayerId   String? // PUBG API의 player ID
  pubgShardId    String? // PUBG API의 shard ID (steam, kakao 등)
  lastUpdated    DateTime @default(now())
  
  matches        PlayerMatch[]
  modeStats      PlayerModeStats[]
}

model PlayerMatch {
  id           Int      @id @default(autoincrement())
  clanMember   ClanMember @relation(fields: [clanMemberId], references: [id])
  clanMemberId Int
  matchId      String   // PUBG match id
  mode         String   // solo/duo/squad 등
  mapName      String?
  placement    Int
  kills        Int
  assists      Int
  // UBD 클랜 멤버에 'soo5woo', 'a-ing-a-ing' 추가
  // ...existing code...
  damage       Float
  surviveTime  Float
  createdAt    DateTime @default(now())
}

model PlayerModeStats {
  id           Int      @id @default(autoincrement())
  clanMember   ClanMember @relation(fields: [clanMemberId], references: [id])
  clanMemberId Int
  mode         String   // solo/duo/squad/fpp/tpp 등
  matches      Int
  wins         Int
  top10s       Int
  avgDamage    Float
  avgKills     Float
  avgAssists   Float
  winRate      Float
  top10Rate    Float
}
